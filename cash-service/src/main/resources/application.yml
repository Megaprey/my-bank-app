server:
  port: 8082

resilience4j:
  circuitbreaker:
    instances:
      accountClient:
        failure-rate-threshold: 50
        wait-duration-in-open-state: 10s
        sliding-window-size: 10
  retry:
    instances:
      accountClient:
        max-attempts: 3
        wait-duration: 500ms
        retry-exceptions:
          - org.springframework.web.reactive.function.client.WebClientResponseException
          - java.io.IOException

spring:
  application:
    name: cash-service
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      acks: all
      retries: 3
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: ${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWKSETURI:http://localhost:9000/oauth2/jwks}
      client:
        registration:
          cash-client:
            provider: auth-server
            client-id: ${OAUTH2_CLIENT_ID:cash-client}
            client-secret: ${OAUTH2_CLIENT_SECRET:cash-secret}
            authorization-grant-type: client_credentials
            scope: accounts
        provider:
          auth-server:
            token-uri: ${SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_AUTHSERVER_TOKENURI:http://localhost:9000/oauth2/token}

services:
  accounts:
    url: ${ACCOUNTS_SERVICE_URL:http://localhost:8081}

logging:
  level:
    root: ${LOG_LEVEL:WARN}
    com.bank: ${LOG_LEVEL:INFO}
    io.github.resilience4j: ${LOG_LEVEL_RESILIENCE4J:DEBUG}
